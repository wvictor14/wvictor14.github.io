{
  "hash": "69886894cb7bfc7be28fca3f730cc179",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"dev_function\"\nformat: \n  html:\n    fig-height: 7\n    fig-width: 8\neditor_options: \n  chunk_output_type: console\n---\n\n\n# Setup\n\n## Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Seurat)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: SeuratObject\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: sp\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'SeuratObject' was built under R 4.5.0 but the current version is\n4.5.1; it is recomended that you reinstall 'SeuratObject' as the ABI\nfor R may have changed\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'SeuratObject' was built with package 'Matrix' 1.7.3 but the current\nversion is 1.7.4; it is recomended that you reinstall 'SeuratObject' as\nthe ABI for 'Matrix' may have changed\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'SeuratObject'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, t\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(SeuratData) # devtools::install_github('satijalab/seurat-data')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Installed datasets ──────────────────────────────── SeuratData v0.2.2.9002 ──\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n✔ hcabm40k 3.0.0                        ✔ pbmc3k   3.1.4\n✔ ifnb     3.1.0                        ✔ pbmcsca  3.0.0\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n────────────────────────────────────── Key ─────────────────────────────────────\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n✔ Dataset loaded successfully\n❯ Dataset built with a newer version of Seurat than installed\n❓ Unknown version of Seurat installed\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(patchwork)\nlibrary(bench)\nlibrary(dittoSeq)\nlibrary(scCustomize)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nscCustomize v3.2.0\nIf you find the scCustomize useful please cite.\nSee 'samuel-marsh.github.io/scCustomize/articles/FAQ.html' for citation info.\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /workspaces/wvictor14.github.io/posts/2025-10-13-fast-umap-plots-in-r\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot2::theme_set(\n  ggplot2::theme_void() +\n    theme(\n      panel.border = element_rect(color = 'black', fill = NA, size = 0.5, linetype = \"solid\"),\n      strip.text.x = element_text(size = rel(1.2)),\n      plot.margin = margin_auto(6, unit = \"pt\")\n    ) \n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\n```\n\n\n:::\n:::\n\n\n## Parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfeatures <- c(\n  \"MS4A1\", # B cell\n  \"CD14\",  # monocytes\n  \"LYZ\",   # monocytes\n  \"GNLY\",  # NK\n  \"FCER1A\",  # dc\n  \"CD3E\",  # T cell\n  \"CD4\",   # CD4\n  \"CD8B\",  # CD8\n  \"FOXP3\"  # Treg \n)\n```\n:::\n\n\n## Datasets\n\n### Load seurat\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseu <- readRDS( here('ifnb.rds'))\n```\n:::\n\n\n# Compared to other packages\n\n::: {.panel-tabset .nav-pills}\n\n## Custom\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scattermore)\nfeatures <- c(\n  \"MS4A1\", # B cell\n  \"CD14\",  # monocytes\n  \"LYZ\",   # monocytes\n  \"GNLY\",  # NK\n  \"FCER1A\",  # dc\n  \"CD3E\",  # T cell\n  \"CD4\",   # CD4\n  \"CD8B\",  # CD8\n  \"FOXP3\"  # Treg \n)\n\nplt_data <- FetchData(\n  object = seu,\n  vars = c(c(\"umap_1\", \"umap_2\"), 'ident', features)\n)\nplt_data <- plt_data |>\n  tidyr::pivot_longer(\n    cols = matches(features),\n    names_to = '.feature',\n    values_to = '.abundance'\n  ) |> \n  \n  ## expressing cells on top\n  arrange(.abundance) |> \n  \n  ## make non-expressing cells NA, to give custom color\n  mutate(.abundance = ifelse(.abundance == 0, NA, .abundance)) \n\np_cd4 <- plt_data |>\n  mutate(.abundance = ifelse(.abundance == 0, NA, .abundance)) |> \n  ggplot(aes(x = umap_1, y = umap_2, color = .abundance)) +\n  geom_scattermore() +\n  facet_wrap(vars(.feature)) +\n  scale_color_continuous(palette = 'viridis')\np_cd4\n```\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n## Seurat\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSeurat::FeaturePlot(seu, features)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `slot` argument of `FetchData()` is deprecated as of SeuratObject 5.0.0.\nℹ Please use the `layer` argument instead.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\nℹ The deprecated feature was likely used in the Seurat package.\n  Please report the issue at <https://github.com/satijalab/seurat/issues>.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n## scCustomize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscCustomize::FeaturePlot_scCustom(seu, features)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nNOTE: FeaturePlot_scCustom uses a specified `na_cutoff` when plotting to\ncolor cells with no expression as background color separate from color scale.\nPlease ensure `na_cutoff` value is appropriate for feature being plotted.\nDefault setting is appropriate for use when plotting from 'RNA' assay.\nWhen `na_cutoff` not appropriate (e.g., module scores) set to NULL to\nplot all cells in gradient color palette.\n\n-----This message will be shown once per session.-----\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n:::\n\n# sampling\n\n35 cells * 9 genes = 315 data points\n\nTry No sampling, and then sampled to 3000 cells\n\n::: {.panel-tabset .nav-pills}\n\n## No Sampling\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_not_sampled <- plt_data |>\n  ggplot(aes(x = umap_1, y = umap_2, color = .abundance)) +\n  geom_point() +\n  facet_wrap(vars(.feature)) +\n  scale_color_continuous(palette = 'viridis', na.value = 'lightgrey')\np_not_sampled\n```\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n## Uniform + scattermore\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_sampled_scattermore <- plt_data |>\n  slice_sample(n = 3000) |> \n  mutate(.abundance = ifelse(.abundance == 0, NA, .abundance)) |> \n  ggplot(aes(x = umap_1, y = umap_2, color = .abundance)) +\n  geom_scattermore(pointsize = 2) +\n  facet_wrap(vars(.feature)) +\n  scale_color_continuous(palette = 'viridis')\np_sampled_scattermore\n```\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\n## Uniform + ggrastr\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggrastr)\np_sampled_ggrastr <- plt_data |>\n  slice_sample(n = 3000) |> \n  mutate(.abundance = ifelse(.abundance == 0, NA, .abundance)) |> \n  ggplot(aes(x = umap_1, y = umap_2, color = .abundance)) +\n  geom_point_rast(size = 1) +\n  facet_wrap(vars(.feature)) +\n  scale_color_continuous(palette = 'viridis', na.value = 'lightgrey')\np_sampled_ggrastr\n```\n\n::: {.cell-output-display}\n![](dev_function_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "dev_function_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}